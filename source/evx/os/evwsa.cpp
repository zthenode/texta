///////////////////////////////////////////////////////////////////////
//   File: evwsa.cpp
//
// Author: $author$
//   Date: 4/6/2007
//
//    $Id$
///////////////////////////////////////////////////////////////////////

#include "evwsa.hpp"

#if defined(WIN32) 
//
// Windows
//
///////////////////////////////////////////////////////////////////////
//  Class: CEvWsa
//
// Author: $author$
//   Date: 4/6/2007
///////////////////////////////////////////////////////////////////////
class EV_EXPORT_CLASS CEvWsa
: public EvWsa
{
public:
    typedef EvWsa CExtends;
    typedef CEvWsa CDerives;

    static CEvWsa* m_wsa;
	WSADATA m_data;

    ///////////////////////////////////////////////////////////////////////
    // Function: GetWsa
    //
    //   Author: $author$
    //     Date: 4/6/2007
    ///////////////////////////////////////////////////////////////////////
    static CEvWsa* GetWsa() 
    {
        return m_wsa;
    }
};
///////////////////////////////////////////////////////////////////////
//  Class: CEvWsa
//
// Author: $author$
//   Date: 4/6/2007
///////////////////////////////////////////////////////////////////////
CEvWsa* CEvWsa::m_wsa = 0;

///////////////////////////////////////////////////////////////////////
//  Class: EvWsa
//
// Author: $author$
//   Date: 4/6/2007
///////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////
// Function: EvWsa::Startup
//
//   Author: $author$
//     Date: 4/6/2007
///////////////////////////////////////////////////////////////////////
EvError EvWsa::Startup
(WORD version) 
{
    EvError error = EV_ERROR_FAILED;
	int err;
    CEvWsa* wsa;

	if ((wsa = CEvWsa::GetWsa()))
	{
		if (version == wsa->m_data.wVersion)
			error = EV_ERROR_NONE;
	}
	else if ((wsa = new CEvWsa()))
	{
		if ((err = WSAStartup(version, &wsa->m_data)))
			delete wsa;

		else error = EV_ERROR_NONE;
	}
    return error;
}
#endif // defined(WIN32)
